const sqlite = require('sqlite3');
const db = new sqlite.Database('3alemny.db')

const createUserTable = `CREATE TABLE IF NOT EXISTS USER (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,   
    EMAIL TEXT UNIQUE NOT NULL,
    ROLE TEXT NOT NULL,
    PASSWORD TEXT NOT NULL
)`;

const createCoursesTable = `CREATE TABLE IF NOT EXISTS COURSES (
    COURSE_ID INTEGER PRIMARY KEY AUTOINCREMENT,
    COURSE_NAME TEXT NOT NULL,
    USER_ID INTEGER NOT NULL,
    CAPACITY INTEGER NOT NULL,
    FOREIGN KEY (USER_ID) REFERENCES USER(ID)
)`;

const createEnrolmentTable = `CREATE TABLE IF NOT EXISTS ENROLMENT (
    COURSE_ID INTEGER NOT NULL,
    STUDENT_ID INTEGER NOT NULL,
    EMAIL TEXT NOT NULL,
    PRIMARY KEY (COURSE_ID, STUDENT_ID),
    FOREIGN KEY (COURSE_ID) REFERENCES COURSES(COURSE_ID),
    FOREIGN KEY (STUDENT_ID) REFERENCES USER(ID)
)`;

const createGradesTable = `CREATE TABLE IF NOT EXISTS GRADES (
    GRADE_ID INTEGER PRIMARY KEY AUTOINCREMENT,
    STUDENT_ID INTEGER NOT NULL,
    COURSE_ID INTEGER NOT NULL,
    GRADE_VALUE TEXT,
    FOREIGN KEY (STUDENT_ID) REFERENCES USER(ID),
    FOREIGN KEY (COURSE_ID) REFERENCES COURSES(COURSE_ID)
)`;

const createMessagesTable = `CREATE TABLE IF NOT EXISTS MESSAGES (
    FROM_USER_ID INTEGER NOT NULL,
    TO_USER_ID INTEGER NOT NULL,
    MESSAGES_HISTORY TEXT,
    PRIMARY KEY (FROM_USER_ID, TO_USER_ID),
    FOREIGN KEY (FROM_USER_ID) REFERENCES USER(ID),
    FOREIGN KEY (TO_USER_ID) REFERENCES USER(ID)
)`;

module.exports = {
    db,
    createUserTable,
    createCoursesTable,
    createEnrolmentTable,
    createGradesTable,
    createMessagesTable,
};

